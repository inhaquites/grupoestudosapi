name: DEV - TableSoccerAPI - CI

on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]    

jobs:
  
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - name: ✔️ Setup .NET Core
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.300        
      
    - name: 🚚 Restauração de Dependências
      run: dotnet restore ./src  
      
    - name: 🎉 Build do Projeto
      run: dotnet build --no-restore  ./src

  publish:
    needs: [build]
  
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - name: ✔️ Setup .NET Core
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.300
      
    - name: 🚀 Publish do Projeto
      run: dotnet publish src/Poker.API/Poker.API.csproj -c Release -o ./publish --nologo
  
    - name: 📂 FTP Deploy
      uses: SamKirkland/FTP-Deploy-Action@4.3.3
      with:
        # Deployment destination server & path. Formatted as protocol://domain.com:port/full/destination/path/
        server: ${{ secrets.POKER_API_FTP_URL }}
        # FTP account username
        username: ${{ secrets.POKER_API_FTP_USER }}        
        # FTP account password
        password: ${{ secrets.POKER_API_FTP_PWD }}        
        # The local folder to copy, defaults to root project folder
        local-dir: /home/runner/work/pokerapi/pokerapi/publish/
